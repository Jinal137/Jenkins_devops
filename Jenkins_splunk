pipeline {
    agent { label 'node1' }
     parameters {
        file(name: 'SPLUNK_DEB', description: 'Upload the Splunk .deb installer')
    }

    environment {
        TARGET_INSTANCE = 'jenkins@192.168.29.92'
    }
    stages {   
       stage('Store in Jenkins') {
            steps {

                script {
                    if (params.SPLUNK_DEB) {
                        archiveArtifacts artifacts: "${params.SPLUNK_DEB}", fingerprint: true
                    } else {
                        error "No file uploaded for SPLUNK_DEB."
                    }
            }
        }
        stage('Transfer and Install Splunk') {
            steps {
                script {
                                  
                    sh "scp splunk.deb ${TARGET_INSTANCE}:/tmp/splunk.deb"
                   
                    sh """
                    ssh ${TARGET_INSTANCE} 'sudo dpkg -i /tmp/splunk.deb && sudo systemctl start splunk'
                    """
                }
            }
        }
    }

    post {
        success {
            echo 'Splunk installed and started successfully!'
        }
       
    }
}

